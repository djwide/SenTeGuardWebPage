---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Join Our Email List | SenTeGuard">
    <section class="section-spacing max-w-4xl mx-auto space-y-8">
        <div class="space-y-3 text-center">
            <p class="text-sm uppercase tracking-[0.3em] text-gray-500">Email List</p>
            <h1>Stay ahead on cognitive security</h1>
            <p class="text-gray-300">Subscribe for product updates, research notes, and launch announcements. We respect your inbox.</p>
        </div>

        <div class="card space-y-4">
            <form class="space-y-3" action="/api/subscribe" method="post" id="page-subscribe-form">
                <label class="flex flex-col gap-2 text-sm text-gray-300">
                    Email
                    <input
                        type="email"
                        name="email"
                        required
                        placeholder="you@example.com"
                        class="rounded-lg border border-gray-800 bg-black px-3 py-2 text-white focus:border-primary focus:outline-none"
                    />
                </label>
                <button class="btn w-full sm:w-auto" type="submit" id="page-subscribe-submit">Join the list</button>
            </form>
            <p id="page-subscribe-message" class="text-sm text-gray-400"></p>
            <ul class="text-sm text-gray-400 list-disc list-inside space-y-1">
                <li>No spam. One to two updates a month.</li>
                <li>Early access to demos and research.</li>
                <li>You can unsubscribe anytime.</li>
            </ul>
        </div>
    </section>

    <script>
        const pageForm = document.getElementById('page-subscribe-form') as HTMLFormElement | null;
        const pageSubmit = document.getElementById('page-subscribe-submit') as HTMLButtonElement | null;
        const pageMsg = document.getElementById('page-subscribe-message') as HTMLParagraphElement | null;

        pageForm?.addEventListener('submit', async (event) => {
            event.preventDefault();
            if (!pageForm || !pageSubmit || !pageMsg) return;

            const formData = new FormData(pageForm);
            const email = formData.get('email');
            if (!email) return;

            pageSubmit.disabled = true;
            pageMsg.textContent = 'Submitting...';
            pageMsg.classList.remove('text-red-400', 'text-green-400');
            pageMsg.classList.add('text-gray-400');

            try {
                const response = await fetch('/api/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const data = await response.json().catch(() => ({}));
                if (response.ok) {
                    pageMsg.textContent = 'Thanks! You are subscribed.';
                    pageMsg.classList.remove('text-gray-400', 'text-red-400');
                    pageMsg.classList.add('text-green-400');
                    pageForm.reset();
                } else {
                    pageMsg.textContent = data.error || 'Unable to subscribe. Please try again.';
                    pageMsg.classList.remove('text-gray-400', 'text-green-400');
                    pageMsg.classList.add('text-red-400');
                }
            } catch (error) {
                pageMsg.textContent = 'Network error. Please try again.';
                pageMsg.classList.remove('text-gray-400', 'text-green-400');
                pageMsg.classList.add('text-red-400');
            } finally {
                pageSubmit.disabled = false;
            }
        });
    </script>
</Layout>
